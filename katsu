address=~/SelfProjects/text-generation-webui

fairseq125m=fairseq-dense-125M
erebus6b=OPT-6.7B-Erebus
pygmalion2b=pygmalion-2.7b
pygmalion350m=pygmalion-350m

default_model=$pygmalion2b

cd $address

command(){
  echo 'RUN '$1
  eval $1
}

start_app() {
  echo 'RUN eval "$(conda shell.bash hook)"'
  eval "$(conda shell.bash hook)"

  command 'conda activate textgen'
  command "python server.py --no-cache $@ --model $default_model"
}

case $1 in
  'a' | 'api' )
    start_app '--api --no-stream'
  ;;

  's' | 'start' )
    start_app '--cai-chat'
  ;;

  't' | 'telegram' )
    start_app '--chat --extension pyrogram_bot'
  ;;


  'u' | 'update' )
    command 'git pull origin main'
    command '~/miniconda3/envs/textgen/bin/python -m pip install -r requirements.txt'
    command 'cd extensions/pyrogram_bot'
    command '~/miniconda3/envs/textgen/bin/python -m pip install -r requirements.txt'
  ;;

  'h' | 'help' )
    echo '
Avaliable commands:
    a, api      - start server in api mode
    h, help     - show this message
    s, start    - start server
    u, update   - update codebase and libraries from repository'
;;

  '*')
    echo '
Please write ./katsu help to see avaliable commands.'
;;

esac
